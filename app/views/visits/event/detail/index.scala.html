@import helper._

@(
user: models.auth.User,
routeList: List[models.route.MapRoute],
locations: List[models.location.MapLocation],
firstLocationVisits: Map[String, Boolean],
locationVisitIndex: Map[String, Option[Int]],
event: String,
distance: Long
)(implicit request: Request[AnyContent])
@templates.main(event + " - Visit", "Profile", Some(user)){

        <div class="row">
            <h1>Event: @event</h1>
        </div>
        <div class="row">
            <div class="alert alert-light" role="alert">
                <p>Distance: @(distance/1000.0)km</p>
                <p>Locations: @locations.size</p>
            </div>
        </div>
        <div class="row">
            <div class="col-sm">
                <div id="map" class="map"></div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm">
                <h2>Locations</h2>
                <ul>
                    @for(location <- locations) {
                    <li><a href="/location/detail/@location.id" target="_blank">@location.name</a>
                        @if(locationVisitIndex(location.id).getOrElse(0) > 0) {
                        <span class="badge badge-light float-right">@locationVisitIndex(location.id)</span>
                        }
                        @if(firstLocationVisits.getOrElse(location.id, false)) {
                        <span class="badge badge-success float-right">First Visit</span>
                        }
                    </li>
                    }
                </ul>
            </div>
            <div class="col-sm">
                <h2>Routes</h2>
                <ul>
                    @for(route <- routeList){
                    <li><a href="/route/detail/@route.from.id/@route.to.id" target="_blank">@route.from.name - @route.to.name</a></li>
                    }
                </ul>
            </div>
        </div>
    </div>

<script type="text/javascript">
        createMap();
        @for(route <- routeList) {
            addSingleConnection(
            {
                "from": {
                    "lat":@route.from.lat,
                    "lon":@route.from.lon
                },
                "to": {
                    "lat":@route.to.lat,
                    "lon":@route.to.lon
                },
                "srs":"@route.srsCode",
                "toc":"@route.toc"
            })
        }


        @for(location <- locations){

            addLocation(
            {
                "location": {
                    "lat":@location.location.lat,
                    "lon":@location.location.lon
                },
                "operator":"@location.operator"
            })
        }


</script>

}